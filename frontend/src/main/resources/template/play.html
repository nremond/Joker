<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html>
<head>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
</head>
<body>

	<div id="info"></div>

	<form id="questionForm" name="questionForm"></form>
	
	<script>
		
		var waitingMsg = '<p>Waiting for other players.</p>';
		waitingMsg += '<p>Be ready !</p>';
		
		$("#info").html(waitingMsg);
		
		//TODO for() loop here
		var questionNumber = 1;
		ask_question();
	
	
		function ask_question() {
			
			$.ajax({
				url: '/api/question/' + questionNumber,
				type: 'GET',
				dataType: 'json',
				success: function(data, textStatus, jqXHR) {
					question_callback(data, textStatus, jqXHR);
				}
			});
			
		}
		
		function question_callback(data, textStatus, jqXHR) {
			console.log("question", data);
			
			var sform = data["question"] + " :<br/>";
			for (var i = 1;; i++) {
				var answer = "answer_" + i;
				
				if(data[answer]){
					sform += "<input type=\"radio\" name=\"answer\" value=\"" 
							 + i + "\">" + data[answer] + "<br/>";
				} else {
					break;
				}
			}
			sform += '<input type="submit" value="OK"/>';
			
			
			$("#info").html("");			
			$("#questionForm").html(sform);
				
			
			$("#questionForm").submit(function(event) {

				// stop form from submitting normally
				event.preventDefault(); 
			
				var form = $(this);
				var	answer = form.find( 'input[name="answer"]' ).val();
			
				$.ajax({
					url :  '/api/answer/' + questionNumber,
					data : '{ "answer" : ' + answer +' }',
					type : 'POST',
					dataType: 'json',
					success: function(data, textStatus, jqXHR) {
						answer_callback(data, textStatus, jqXHR);
					}
				});
						
			});
			
		}
	
		function answer_callback(data, textStatus, jqXHR) {
			console.log("answer", data);
			
			var ok = data['are_u_ok'];
			//var good_answer = data["good_answer"];
			var score = data['score'];
			
			var okMsg = ok ? 'Good' : 'Bad';		
			var resultMsg = '<p>' + okMsg + ' answer !<br/>';
			resultMsg += 'Your score : ' + score + ' points</p>';
			
			$("#info").html(resultMsg + waitingMsg);
			$("#questionForm").html("");
			
			questionNumber++;
			ask_question();
		}
	
	</script>
</body>
</html>
